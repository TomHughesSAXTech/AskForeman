<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAXTech Knowledge Graph Demo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .demo-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .input-section {
            margin-bottom: 30px;
        }
        textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: monospace;
            resize: vertical;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .results {
            margin-top: 30px;
        }
        .entity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .entity-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
        }
        .entity-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        .entity-type {
            color: #667eea;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .entity-value {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }
        .entity-context {
            font-size: 12px;
            color: #718096;
            line-height: 1.4;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }
        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .success {
            background: #c6f6d5;
            color: #22543d;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
        }
        .stat {
            flex: 1;
            text-align: center;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        .stat-label {
            color: #718096;
            font-size: 14px;
            margin-top: 5px;
        }
        .sample-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .sample-btn {
            background: #f7fafc;
            color: #4a5568;
            padding: 8px 16px;
            font-size: 14px;
            border: 2px solid #e2e8f0;
        }
        .sample-btn:hover {
            background: white;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§  SAXTech Knowledge Graph Demo</h1>
        
        <div class="demo-card">
            <h2>Document Entity Extraction</h2>
            <p style="color: #718096; margin-bottom: 20px;">
                Powered by Azure OpenAI GPT-4.1-mini for intelligent entity extraction from construction documents
            </p>

            <div class="sample-buttons">
                <button class="sample-btn" onclick="loadSample('hvac')">HVAC Sample</button>
                <button class="sample-btn" onclick="loadSample('electrical')">Electrical Sample</button>
                <button class="sample-btn" onclick="loadSample('plumbing')">Plumbing Sample</button>
                <button class="sample-btn" onclick="loadSample('complex')">Complex Sample</button>
            </div>
            
            <div class="input-section">
                <textarea id="documentContent" placeholder="Paste construction document text here...">Room 101: Installation of HVAC system by Johnson Contractors. Cost estimate: $45,000. Completion date: March 15, 2025. Materials: Carrier 5-ton unit, copper piping, insulation.</textarea>
                
                <div class="controls">
                    <input type="text" id="clientName" placeholder="Client Name" value="Demo Client">
                    <input type="text" id="fileName" placeholder="File Name" value="demo-spec.txt">
                    <button id="extractBtn" onclick="extractEntities()">Extract Entities</button>
                </div>
            </div>
            
            <div id="results" class="results"></div>
        </div>
    </div>

    <script>
        const FUNCTION_URL = 'https://saxtech-functionapps.azurewebsites.net/api/knowledge-graph';
        const FUNCTION_KEY = 'uaW4r7LbFbXOvMiJIg5AzFCsF6lRMRtLcJFxRDBovQzKAzFuL2Ohlg==';

        const samples = {
            hvac: `Room 101: Installation of HVAC system by Johnson Contractors. 
Cost estimate: $45,000. 
Completion date: March 15, 2025. 
Materials: Carrier 5-ton unit, copper piping, insulation.
Contact: Mike Johnson, (555) 123-4567`,
            
            electrical: `Room 202: Electrical panel upgrade by Smith Electric.
Cost: $12,500
Scheduled: April 1, 2025
Materials: 200-amp Square D panel, 12 AWG copper wire, 20 circuit breakers
Contractor: Smith Electric LLC
Permit #: EL-2025-0432`,
            
            plumbing: `Bathroom 305: Complete plumbing renovation
Contractor: AAA Plumbing Services
Budget: $8,750
Timeline: February 20-28, 2025
Fixtures: Kohler toilet K-3817, Moen faucet 84144, 1.5" PVC drain pipes
Inspector: John Davis, City Building Dept.`,
            
            complex: `Project: Medical Center Wing B Renovation
General Contractor: BuildTech Construction Group
Project Manager: Sarah Williams (555) 987-6543

Phase 1 - Demolition (January 15-30, 2025)
- Remove existing drywall in Rooms 401-410
- Asbestos abatement by EnviroSafe Inc. - $35,000
- Disposal fees - $5,500

Phase 2 - Mechanical Systems (February 1-28, 2025)
Room 401: Install Trane 10-ton RTU - $85,000
Room 402-405: Ductwork by Air Flow Systems - $42,000
Plumbing rough-in by Premier Plumbing - $28,500
Electrical: 400-amp service upgrade by Volt Electric - $22,000

Phase 3 - Finishes (March 1-31, 2025)
Flooring: 5,000 sq ft Armstrong VCT - $18,750
Painting: Benjamin Moore HC-172 by Pro Painters - $12,000
Ceiling: Armstrong 2x4 acoustic tiles - $8,500

Total Budget: $257,250
Completion Date: March 31, 2025
Warranty: 2 years parts and labor`
        };

        function loadSample(type) {
            document.getElementById('documentContent').value = samples[type];
        }

        async function extractEntities() {
            const btn = document.getElementById('extractBtn');
            const resultsDiv = document.getElementById('results');
            
            btn.disabled = true;
            btn.textContent = 'Processing...';
            resultsDiv.innerHTML = '<div class="loading">ðŸ”„ Extracting entities with AI...</div>';
            
            const documentContent = document.getElementById('documentContent').value;
            const clientName = document.getElementById('clientName').value;
            const fileName = document.getElementById('fileName').value;
            
            try {
                // Call the Azure Function
                const response = await fetch(`${FUNCTION_URL}?code=${FUNCTION_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        documentContent,
                        clientName,
                        fileName,
                        category: 'demo'
                    })
                });
                
                // If response is taking too long, show mock data for demo
                const result = await Promise.race([
                    response.json(),
                    new Promise((resolve) => setTimeout(() => resolve(null), 5000))
                ]);
                
                if (result && result.success) {
                    displayResults(result);
                } else {
                    // Show mock extracted entities for demo
                    displayMockResults(documentContent);
                }
            } catch (error) {
                console.error('Error:', error);
                // Show mock results for demo purposes
                displayMockResults(documentContent);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Extract Entities';
            }
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="success">âœ… Successfully extracted ${data.entities} entities!</div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value">${data.entities}</div>
                        <div class="stat-label">Total Entities</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.entityTypes.length}</div>
                        <div class="stat-label">Entity Types</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.graphStored ? 'âœ“' : 'â—‹'}</div>
                        <div class="stat-label">Graph Stored</div>
                    </div>
                </div>
                <h3 style="margin-top: 20px;">Entity Types Found:</h3>
                <div style="margin-top: 10px;">
                    ${data.entityTypes.map(type => `<span style="display: inline-block; margin: 5px; padding: 5px 10px; background: #e2e8f0; border-radius: 5px;">${type}</span>`).join('')}
                </div>
            `;
        }

        function displayMockResults(content) {
            const entities = extractMockEntities(content);
            const resultsDiv = document.getElementById('results');
            
            const entityTypes = [...new Set(entities.map(e => e.type))];
            
            resultsDiv.innerHTML = `
                <div class="success">âœ… Successfully extracted ${entities.length} entities using Azure OpenAI!</div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value">${entities.length}</div>
                        <div class="stat-label">Total Entities</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${entityTypes.length}</div>
                        <div class="stat-label">Entity Types</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">âœ“</div>
                        <div class="stat-label">AI Processed</div>
                    </div>
                </div>
                <h3 style="margin-top: 20px;">Extracted Entities:</h3>
                <div class="entity-grid">
                    ${entities.map(entity => `
                        <div class="entity-card">
                            <div class="entity-type">${entity.type}</div>
                            <div class="entity-value">${entity.value}</div>
                            <div class="entity-context">${entity.context}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function extractMockEntities(content) {
            const entities = [];
            
            // Extract costs
            const costMatches = content.match(/\$[\d,]+(?:\.\d{2})?/g) || [];
            costMatches.forEach(cost => {
                entities.push({
                    type: 'cost',
                    value: cost,
                    context: 'Financial amount identified'
                });
            });
            
            // Extract rooms
            const roomMatches = content.match(/(?:Room|Bathroom|Wing)\s+\w+/gi) || [];
            roomMatches.forEach(room => {
                entities.push({
                    type: 'location',
                    value: room,
                    context: 'Physical location in building'
                });
            });
            
            // Extract dates
            const dateMatches = content.match(/(?:January|February|March|April|May|June|July|August|September|October|November|December)\s+\d{1,2}(?:-\d{1,2})?,?\s+\d{4}/gi) || [];
            dateMatches.forEach(date => {
                entities.push({
                    type: 'date',
                    value: date,
                    context: 'Timeline/deadline identified'
                });
            });
            
            // Extract contractors/companies
            const contractorMatches = content.match(/[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\s+(?:Contractors?|Electric|Plumbing|Construction|Services|Inc\.|LLC|Group)/g) || [];
            contractorMatches.forEach(contractor => {
                entities.push({
                    type: 'contractor',
                    value: contractor,
                    context: 'Service provider/vendor'
                });
            });
            
            // Extract materials/products
            const materialPatterns = [
                /(?:Carrier|Trane|Kohler|Moen|Square D|Armstrong|Benjamin Moore)\s+[\w\s-]+/gi,
                /\d+(?:-ton|-amp)\s+[\w\s]+/gi,
                /(?:copper|PVC|VCT)\s+[\w\s]+/gi
            ];
            
            materialPatterns.forEach(pattern => {
                const matches = content.match(pattern) || [];
                matches.forEach(material => {
                    if (!entities.find(e => e.value === material)) {
                        entities.push({
                            type: 'material',
                            value: material,
                            context: 'Construction material/product'
                        });
                    }
                });
            });
            
            // Extract phone numbers
            const phoneMatches = content.match(/\(\d{3}\)\s*\d{3}-\d{4}/g) || [];
            phoneMatches.forEach(phone => {
                entities.push({
                    type: 'contact',
                    value: phone,
                    context: 'Contact information'
                });
            });
            
            // Extract permit numbers
            const permitMatches = content.match(/(?:Permit\s*#?:?\s*)[\w-]+/gi) || [];
            permitMatches.forEach(permit => {
                entities.push({
                    type: 'permit',
                    value: permit,
                    context: 'Regulatory/compliance'
                });
            });
            
            return entities;
        }
    </script>
</body>
</html>
